

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flume Overview &mdash; Flume  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Useful Methods Demonstration for Analysis Instances" href="analysis_methods_demo.html" />
    <link rel="prev" title="Flume" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Flume
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><em>Flume</em> Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Framework-Nomenclature">Framework Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Defining-an-Analysis-Class">Defining an <em>Analysis</em> Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#__init__-Method"><code class="docutils literal notranslate"><span class="pre">__init__</span></code> Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#_analyze-Method"><code class="docutils literal notranslate"><span class="pre">_analyze</span></code> Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#_analyze_adjoint-Method"><code class="docutils literal notranslate"><span class="pre">_analyze_adjoint</span></code> Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Setting-up-a-System">Setting up a <em>System</em></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Creating-Analsis-Instances">Creating <em>Analsis</em> Instances</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Formulating-an-Optimization-Problem">Formulating an Optimization Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Optimizing-with-the-SciPy-Interface">Optimizing with the SciPy Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Executing-the-Optimization-Script">Executing the Optimization Script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Other-Resources-to-Review">Other Resources to Review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="analysis_methods_demo.html">Useful Methods Demonstration for <em>Analysis</em> Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_class_reference.html">Base Class Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface_reference.html">Interfaces Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Flume</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><em>Flume</em> Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/flume_overview.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Flume-Overview">
<h1><em>Flume</em> Overview<a class="headerlink" href="#Flume-Overview" title="Link to this heading"></a></h1>
<p>The purpose of this file is to outline in detail the use of <em>Flume</em> and a workflow for the framework. For a new user, this file will broadly outline the following:</p>
<ul class="simple">
<li><p>Nomenclature utilized for the framework</p></li>
<li><p>Construction of an <em>Analysis</em> class, which internally uses <em>State</em> objects to define variables and outputs</p></li>
<li><p>Defining instances of <em>Analysis</em> classes and the role of <code class="docutils literal notranslate"><span class="pre">sub_analyses</span></code> to connect outputs to inputs</p></li>
<li><p>Assembly of a <em>System</em> with specific instances of <em>Analysis</em> classes To address these points, this notebook will provide sections of code with accompanying descriptions regarding the use of the various base classes and how to set up an optimization problem.</p></li>
</ul>
<section id="Framework-Nomenclature">
<h2>Framework Nomenclature<a class="headerlink" href="#Framework-Nomenclature" title="Link to this heading"></a></h2>
<p>Before including any code, it is important to clarify the nomenclature that is used within the framework. All <em>Analysis</em> classes contain at least one variable and output, and they may optionally include parameters. In the context of <em>Flume</em>, these are defined as follows.</p>
<ul class="simple">
<li><p><strong>Parameter</strong>: Numerical, boolean, string, or other data type that are nominally set during the construction of an <em>Analysis</em> object. Parameters represent one type of inputs to an analysis procedure, but they are not candidates for design variables, as they are set during object construction and are (generally) not changed after this point. Parameters are stored within a dictionary, an attribute of the <em>Analysis</em> class entitled <code class="docutils literal notranslate"><span class="pre">parameters</span></code>, where the keys correspond to the parameters’ names
and the values take on the actual values of the parameters.</p></li>
<li><p><strong>Variable</strong>: Numerical quantities (either floats or NumPy arrays) that are candidates for design variables during optimization. This is the second type of inputs to an analysis procedure and are numerical quantities used to compute outputs of an <em>Analysis</em> class. Variables are stored within a dictionary, an attribute of the <em>Analysis</em> class entitled <code class="docutils literal notranslate"><span class="pre">variables</span></code>, where the keys correspond to the local variable name and the values are instances of <em>State</em> objects. By defining each variable as
a <em>State</em>, it contains information beyond its numerical value, including the data type, shape, description, derivative, and source. If sub-analyses exist for an <em>Analysis</em> class, then variables may be sourced from another object if its local variable name is the same as an output of a connected sub-analysis (see <strong>insert section</strong> for additional details).</p></li>
<li><p><strong>Output</strong>: Outputs are similar in nature to variables, but they are the quantities determined from performing the analysis procedure with a given set of parameters and variables. Output values are also wrapped within <em>State</em> objects, so information about an output is accessed in the same way as variables by accessing the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> attribute of an <em>Analysis</em> class. As mentioned above, outputs of a sub-analysis can be connected to variables for another <em>Analysis</em> class if they share the same
local names.</p></li>
</ul>
<p>These three terms are used throughout the framework but will be further explained in context below.</p>
</section>
<section id="Defining-an-Analysis-Class">
<h2>Defining an <em>Analysis</em> Class<a class="headerlink" href="#Defining-an-Analysis-Class" title="Link to this heading"></a></h2>
<p>Now, consider the code below, which defines the Rosenbrock <em>Analysis</em>, which is responsible for evaluating</p>
<div class="math notranslate nohighlight">
\[f(x,y)=(a-x)^2 + b(y - x^2)^2,\]</div>
<p>where <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are parameter values and <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are current variable values. The entire code is shown first, and then each method is explained in greater detail.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Rosenbrock</span><span class="p">(</span><span class="n">Analysis</span><span class="p">):</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

      <span class="c1"># Set the default parameters</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">default_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">}</span>

      <span class="c1"># Perform the base class object initialization</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obj_name</span><span class="o">=</span><span class="n">obj_name</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="n">sub_analyses</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

      <span class="c1"># Set the default State for the variables</span>
      <span class="n">xvar</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;x state value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
      <span class="n">yvar</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;y state value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

      <span class="c1"># Construct variables dictionary</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xvar</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yvar</span><span class="p">}</span>

      <span class="k">return</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># Extract the variable values</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

      <span class="c1"># Extract the parameter values</span>
      <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
      <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>

      <span class="c1"># Compute the value of the Rosenbrock function</span>
      <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

      <span class="c1"># Update the analyzed attribute</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">analyzed</span> <span class="o">=</span> <span class="kc">True</span>

      <span class="c1"># Store the outputs</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
          <span class="n">value</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Rosenbrock function value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span>
      <span class="p">)</span>

      <span class="k">return</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># Extract the derivatives of the outputs</span>
      <span class="n">fb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>

      <span class="c1"># Extract the variable values</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

      <span class="c1"># Extract the variable derivatives</span>
      <span class="n">xb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>
      <span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>

      <span class="c1"># Extract the parameter values</span>
      <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
      <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>

      <span class="c1"># Compute xb</span>
      <span class="n">xb</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">fb</span>

      <span class="c1"># Compute yb</span>
      <span class="n">yb</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">fb</span>

      <span class="c1"># Update the analyzed adjoint attribute</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">adjoint_analyzed</span> <span class="o">=</span> <span class="kc">True</span>

      <span class="c1"># Assign the derivative values</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_deriv_value</span><span class="p">(</span><span class="n">deriv_val</span><span class="o">=</span><span class="n">xb</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_deriv_value</span><span class="p">(</span><span class="n">deriv_val</span><span class="o">=</span><span class="n">yb</span><span class="p">)</span>

      <span class="k">return</span>
</pre></div>
</div>
<section id="__init__-Method">
<h3><code class="docutils literal notranslate"><span class="pre">__init__</span></code> Method<a class="headerlink" href="#__init__-Method" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method is responsible for constructing the object, similar to a regular Python class. Regardless of the purpose of the <em>Analysis</em> class, this method must provide an object name <code class="docutils literal notranslate"><span class="pre">obj_name</span></code>, a list of sub-analyses <code class="docutils literal notranslate"><span class="pre">sub_analyses</span></code>, and any keyword arguments <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>. When constructing a specific instance of this class, the <code class="docutils literal notranslate"><span class="pre">sub_analyses</span></code> list may be empty or contain other <em>Analysis</em> objects, but the definition of the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method does not have to contain this
information.</p>
<p>Next, the default parameter values are defined for the current class with the following line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">default_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">}</span>
</pre></div>
</div>
<p>Default parameters must be provided here, as they are one of the required inputs to compute the outputs. If the user wants to override the default parameter values, they are passed in as keyword arguments during object construction. In the event that an <em>Analysis</em> class does not have any parameters, the <code class="docutils literal notranslate"><span class="pre">default_parameters</span></code> attribute should be defined as an empty dictionary to denote this. The base class object initialization is then performed by calling</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obj_name</span><span class="o">=</span><span class="n">obj_name</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="n">sub_analyses</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This performs various backend assignment procedures and is necessary to properly interface with the framework. Similar to the parameters, default variable <em>States</em> are defined with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xvar</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;x state value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="n">yvar</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;y state value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the variables for <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> define the default value, description, and source information. When defining the source information, it is always <code class="docutils literal notranslate"><span class="pre">self</span></code>. Even if the variable is intended to be sourced from another object, this information is updated on the backend if a connection is identified between an outputs and variables. Finally, the variable <em>States</em> are assigned into the <code class="docutils literal notranslate"><span class="pre">variables</span></code> dictionary</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">xvar</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">yvar</span><span class="p">}</span>
</pre></div>
</div>
<p>This concludes the required parts of the constructor method, but additional modifications are possible based on a user’s individual needs for their <em>Analysis</em> classes.</p>
</section>
<section id="_analyze-Method">
<h3><code class="docutils literal notranslate"><span class="pre">_analyze</span></code> Method<a class="headerlink" href="#_analyze-Method" title="Link to this heading"></a></h3>
<p>The primary intent of this method is to compute the outputs of interest using the input values for the parameters and variables. To do so, the variable values and parameters are extracted with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the variable values</span>
<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Extract the parameter values</span>
<span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Here, it should be noted that variables must include the additional <code class="docutils literal notranslate"><span class="pre">.value</span></code> to access the value contained within the associated <em>State</em> object. Parameters do not require this because they are not wrapped with the <em>State</em> class. The next section of this method is dedicated to evaluating discipline specific computations that determine the outputs. For the Rosenbrock function, this is done by simply evaluating</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>After the outputs are computed, the user should update the <code class="docutils literal notranslate"><span class="pre">analyzed</span></code> attribute to denote that computations have concluded for the current <em>Analysis</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">analyzed</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This is used internally to avoid recomputing data if an <em>Analysis</em> appears multiple times within a <em>System</em> before variable values are updated. Then, the outputs are stored within the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> dictionary, where the values are again wrapped in <em>State</em> objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Store the outputs</span>
<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Rosenbrock function value&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Nothing is returned from this method, as the output values are stored within the class instance and are accessed by interacting with this object.</p>
</section>
<section id="_analyze_adjoint-Method">
<h3><code class="docutils literal notranslate"><span class="pre">_analyze_adjoint</span></code> Method<a class="headerlink" href="#_analyze_adjoint-Method" title="Link to this heading"></a></h3>
<p>Comparable to the previous method, <code class="docutils literal notranslate"><span class="pre">_analyze_adjoint</span></code> is responsible for propagating the derivatives from the outputs back to the variables. Within <em>Flume</em>, the variables for an individual discipline are treated as design variables for the adjoint method. As a result, if the outputs are explicit functions of the input variables, then the user is responsible for computing the partial derivatives of the outputs with respect to the variables and accounting for the impact of the adjoint variables.
However, if an <em>Analysis</em> internally performs some linear or nonlinear solve to compute additional state variables, the full form of the adjoint method should be used to compute the contributions to the variables’ derivatives. A full discussion of the adjoint method is not in the scope of this overview, but its role within <em>Flume</em> can be understood through this example. To begin the method, variable and output derivatives are extracted along with the variable values. Similar to values,
derivatives are accessed using the <code class="docutils literal notranslate"><span class="pre">.deriv</span></code> extension for <em>State</em> objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the variable values</span>
<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Extract the variable derivatives</span>
<span class="n">xb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>
<span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>

<span class="c1"># Extract the output derivatives</span>
<span class="n">gb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">deriv</span>
</pre></div>
</div>
<p>Next, since this discipline computes <span class="math notranslate nohighlight">\(f\)</span> as an explicit function of <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>, the adjoint method simplifies to multiplying the adjoint variables <span class="math notranslate nohighlight">\(\bar{g}\)</span> or <code class="docutils literal notranslate"><span class="pre">gb</span></code> by the partial derivatives of the output with respect to each variable. Note that the addition assignment <code class="docutils literal notranslate"><span class="pre">+=</span></code> operator is used to update, not overwrite, the derivatives for the variables. This is critical to ensure that derivatives already computed for <span class="math notranslate nohighlight">\(\bar{x}\)</span> (<code class="docutils literal notranslate"><span class="pre">xb</span></code>) and <span class="math notranslate nohighlight">\(\bar{y}\)</span>
(<code class="docutils literal notranslate"><span class="pre">yb</span></code>) do not get discarded.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the contributions to xb and yb</span>
<span class="n">xb</span> <span class="o">+=</span> <span class="n">gb</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
<span class="n">yb</span> <span class="o">+=</span> <span class="n">gb</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span>
</pre></div>
</div>
<p>After computing the derivatives, the user should update the <code class="docutils literal notranslate"><span class="pre">adjoint_analyzed</span></code> attribute to denote that computations for the derivatives have concluded, similar to the behavior for the <code class="docutils literal notranslate"><span class="pre">_analyze</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update the analyzed adjoint attribute</span>
<span class="bp">self</span><span class="o">.</span><span class="n">adjoint_analyzed</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Finally, the derivative values are assigned to the <em>State</em> objects stored within the <code class="docutils literal notranslate"><span class="pre">variables</span></code> dictionary, which ensures that these quantities are stored before concluding the current <code class="docutils literal notranslate"><span class="pre">_analyze_adjoint</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign the derivative values</span>
<span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_deriv_value</span><span class="p">(</span><span class="n">deriv_val</span><span class="o">=</span><span class="n">xb</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_deriv_value</span><span class="p">(</span><span class="n">deriv_val</span><span class="o">=</span><span class="n">yb</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, nothing is returned from this method, as the derivatives are updated within the <em>State</em> objects for the specific class instance.</p>
</section>
</section>
<section id="Setting-up-a-System">
<h2>Setting up a <em>System</em><a class="headerlink" href="#Setting-up-a-System" title="Link to this heading"></a></h2>
<p>Using the procedure outlined above to define various <em>Analysis</em> classes, emphasis will now be placed on combining <em>Analysis</em> instances together to construct a <em>System</em>. Here, the classes associated with the constrained Rosenbrock example will be utilized, which are located <a class="reference external" href="../examples/rosenbrock/rosenbrock_problem_classes.py">here</a>. First, the entire script to define a <em>System</em> is shown, and detailed descriptions will be included below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct the design variables object</span>
<span class="n">rosenbrock_dvs</span> <span class="o">=</span> <span class="n">RosenbrockDVs</span><span class="p">(</span><span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;dvs&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># Construct the analysis object for the Rosenbrock function</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">100.0</span>

<span class="n">rosenbrock</span> <span class="o">=</span> <span class="n">Rosenbrock</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;rosenbrock&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span>
<span class="p">)</span>

<span class="c1"># Construct the analysis object for the constraint on the design variables</span>
<span class="n">rosenbrock_con</span> <span class="o">=</span> <span class="n">RosenbrockConstraint</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;con&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Construct the system</span>
<span class="n">flume_sys</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span>
    <span class="n">sys_name</span><span class="o">=</span><span class="s2">&quot;rosen_sys_con&quot;</span><span class="p">,</span>
    <span class="n">top_level_analysis_list</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock</span><span class="p">,</span> <span class="n">rosenbrock_con</span><span class="p">],</span>
    <span class="n">log_name</span><span class="o">=</span><span class="s2">&quot;flume.log&quot;</span><span class="p">,</span>
    <span class="n">log_prefix</span><span class="o">=</span><span class="s2">&quot;examples/rosenbrock_constrained&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Graph the system network to visualize connections</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">flume_sys</span><span class="o">.</span><span class="n">graph_network</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;ConstrainedRosenbrock&quot;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;examples/rosenbrock_constrained&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="Creating-Analsis-Instances">
<h3>Creating <em>Analsis</em> Instances<a class="headerlink" href="#Creating-Analsis-Instances" title="Link to this heading"></a></h3>
<p>Before assembling the <em>System</em>, it is necessary to create instances of the <em>Analysis</em> classes that are intended to be used within the <em>System</em>. The first object is the <code class="docutils literal notranslate"><span class="pre">RosenBrockDVs</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct the design variables object</span>
<span class="n">rosenbrock_dvs</span> <span class="o">=</span> <span class="n">RosenbrockDVs</span><span class="p">(</span><span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;dvs&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
<p>This simply maps design variables <code class="docutils literal notranslate"><span class="pre">x_dv</span></code> and <code class="docutils literal notranslate"><span class="pre">y_dv</span></code> to <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>. This creates a single set of outputs for <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> that can then be distributed to the other parts of the <em>System</em>. A unique name is given to the object, and no sub-analyses are provided, as this object defines the source for <code class="docutils literal notranslate"><span class="pre">x_dv</span></code> and <code class="docutils literal notranslate"><span class="pre">y_dv</span></code>. Next, instances of the <code class="docutils literal notranslate"><span class="pre">Rosenbrock</span></code> and <code class="docutils literal notranslate"><span class="pre">RosenbrockConstraint</span></code> <em>Analysis</em> classes are created</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct the analysis object for the Rosenbrock function</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">100.0</span>

<span class="n">rosenbrock</span> <span class="o">=</span> <span class="n">Rosenbrock</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;rosenbrock&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span>
<span class="p">)</span>

<span class="c1"># Construct the analysis object for the constraint on the design variables</span>
<span class="n">rosenbrock_con</span> <span class="o">=</span> <span class="n">RosenbrockConstraint</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;con&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here, the values for <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are passed as keyword arguments to the <code class="docutils literal notranslate"><span class="pre">Rosenbrock</span> <span class="pre">class</span></code> to set the parameter values. Also, each class takes the <code class="docutils literal notranslate"><span class="pre">rosenbrock_dvs</span></code> instance as a sub-analysis. This creates a connection between the outputs for <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> from <code class="docutils literal notranslate"><span class="pre">rosenbrock_dvs</span></code> to the input <code class="docutils literal notranslate"><span class="pre">variables</span></code> for both <code class="docutils literal notranslate"><span class="pre">rosenbrock</span></code> and <code class="docutils literal notranslate"><span class="pre">rosenbrock_con</span></code>. If this is not done, then the values for <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> will not be distributed throughout the model correctly. Finally, the <em>System</em>
is constructed with the following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct the system</span>
<span class="n">flume_sys</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span>
    <span class="n">sys_name</span><span class="o">=</span><span class="s2">&quot;rosen_sys_con&quot;</span><span class="p">,</span>
    <span class="n">top_level_analysis_list</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock</span><span class="p">,</span> <span class="n">rosenbrock_con</span><span class="p">],</span>
    <span class="n">log_name</span><span class="o">=</span><span class="s2">&quot;flume.log&quot;</span><span class="p">,</span>
    <span class="n">log_prefix</span><span class="o">=</span><span class="s2">&quot;examples/rosenbrock_constrained&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>A name is provided for the system, and the top-level analysis list is specified by providing the <code class="docutils literal notranslate"><span class="pre">rosenbrock</span></code> and <code class="docutils literal notranslate"><span class="pre">rosenbrock_con</span></code> objects as a list. This top-level analysis list corresponds to the <em>Analysis</em> objects whose outputs will be used as the objective or constraint functions for optimization. Additionally, a name for the log file and output directory are provided for file management purposes. To ensure that outputs and variables are connected correctly, the structure of the <em>System</em>
can be visualized by calling the following function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graph the system network to visualize connections</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">flume_sys</span><span class="o">.</span><span class="n">graph_network</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;ConstrainedRosenbrock&quot;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;examples/rosenbrock_constrained&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This constructs a document using graphviz that provides a visual representation of the <em>System</em> network. If it is found that outputs and variables are not connected within the diagram, this likely indicates that a <code class="docutils literal notranslate"><span class="pre">sub_analyses</span></code> list is missing an entry to define the flow of information.</p>
</section>
</section>
<section id="Formulating-an-Optimization-Problem">
<h2>Formulating an Optimization Problem<a class="headerlink" href="#Formulating-an-Optimization-Problem" title="Link to this heading"></a></h2>
<p>With the <em>System</em> assembled, the next step is to declare the design variables, objective function, and constraints that will be utilized for the optimization problem. In all cases, global names are utilized to identify these <em>States</em>, which is denoted with <code class="docutils literal notranslate"><span class="pre">object_name.local_state_name</span></code>. For the design variables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Declare the design variables for the system</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_design_vars</span><span class="p">(</span>
    <span class="n">global_var_name</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;dvs.x_dv&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lb&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
        <span class="s2">&quot;dvs.y_dv&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lb&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The user can optionally provide applicable scalar lower and upper bound values. If the variable is an array, then the bounds are still provided as scalars, and each variable in the array is then given the same bounds. Next, the objective function is specified</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Declare the objective</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_objective</span><span class="p">(</span><span class="n">global_obj_name</span><span class="o">=</span><span class="s2">&quot;rosenbrock.f&quot;</span><span class="p">,</span> <span class="n">obj_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The second argument <code class="docutils literal notranslate"><span class="pre">obj_scale</span></code> is optional, but it defines a scaling factor that, when multiplied by the objective function’s value, should scale the value to <span class="math notranslate nohighlight">\(\mathcal{O}(1)\)</span>. This product is the quantity that the optimizer will see. Finally, constraints are specified with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Declare the constraint</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_constraints</span><span class="p">(</span>
    <span class="n">global_con_name</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;con.g&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;leq&quot;</span><span class="p">,</span> <span class="s2">&quot;rhs&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The syntax here corresponds to providing a dictionary of dictionaries, where each outer key corresponds to the constraint affecting the optimization problem. The inner dictionaries provide information regarding the constraint type and direction, that is less than or equal to <code class="docutils literal notranslate"><span class="pre">leq</span></code>, greater than or equal to <code class="docutils literal notranslate"><span class="pre">geq</span></code>, or an equality constraint <code class="docutils literal notranslate"><span class="pre">both</span></code>. Additionally, the right-hand side value <code class="docutils literal notranslate"><span class="pre">rhs</span></code> for the constraint is provided, which is also used to scale the constraints internally. For this
example, the declared constraint is such that the output <code class="docutils literal notranslate"><span class="pre">g</span></code> of the object named <code class="docutils literal notranslate"><span class="pre">con</span></code> should be less than or equal to <span class="math notranslate nohighlight">\(1.0\)</span>.</p>
</section>
<section id="Optimizing-with-the-SciPy-Interface">
<h2>Optimizing with the SciPy Interface<a class="headerlink" href="#Optimizing-with-the-SciPy-Interface" title="Link to this heading"></a></h2>
<p>After constructing the <em>System</em> and specifying the optimization problem formulation, numerical optimization can be performed by using one of <em>Flume</em>’s optimizer interfaces. To date, the supported interfaces include <a class="reference external" href="https://github.com/smdogroup/paropt">ParOpt</a> and <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">SciPy</a>. In this example, the SciPy interface will be utilized, which is done with the following lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct the Scipy interface</span>
<span class="n">interface</span> <span class="o">=</span> <span class="n">FlumeScipyInterface</span><span class="p">(</span><span class="n">flume_sys</span><span class="o">=</span><span class="n">flume_sys</span><span class="p">)</span>

<span class="c1"># Set a random starting point</span>
<span class="n">init_global_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dvs.x_dv&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="s2">&quot;dvs.y_dv&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">initial_point</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">set_initial_point</span><span class="p">(</span>
    <span class="n">initial_global_vars</span><span class="o">=</span><span class="n">init_global_vars</span>
<span class="p">)</span>

<span class="c1"># Optimize the problem with SciPy minimize</span>
<span class="n">x</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">optimize_system</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">initial_point</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;SLSQP&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>First, an instance of the <em>FlumeScipyInterface</em> is constructed by providing the class with the instance of the <em>System</em>. Then, an initial starting point, random in this case, is determined and mapped into a NumPy array with the <code class="docutils literal notranslate"><span class="pre">set_initial_point</span></code> method. Finally, the <em>System</em> is optimized by calling <code class="docutils literal notranslate"><span class="pre">optimize_system</span></code> with the initial point and desired method. The default method is SLSQP, and the user can optionally provide a maximum number of iterations and options for the optimization
method that align with the SciPy documentation. The output of this method is the optimal set of design variables <code class="docutils literal notranslate"><span class="pre">x</span></code> and the <em>OptimizationResult</em> instance from SciPy <code class="docutils literal notranslate"><span class="pre">res</span></code>.</p>
<section id="Executing-the-Optimization-Script">
<h3>Executing the Optimization Script<a class="headerlink" href="#Executing-the-Optimization-Script" title="Link to this heading"></a></h3>
<p>Below the setup of the <em>System</em> and optimization portions of the script are repeated and can be executed to explore <em>Flume</em> in action. This will print the optimal values for the design variables, which should be <span class="math notranslate nohighlight">\(x^*\approx 0.786, y^* \approx 0.618\)</span> for the constrained Rosenbrock example. It will also output the <em>OptimizeResult</em> instance returned by SciPy.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span>--quiet
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Add the root directory of the repository</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flume.base_classes.system</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flume.interfaces.scipy_interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlumeScipyInterface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">examples.rosenbrock.rosenbrock_problem_classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">RosenbrockDVs</span><span class="p">,</span> <span class="n">Rosenbrock</span><span class="p">,</span> <span class="n">RosenbrockConstraint</span>

<span class="c1"># Construct the design variables object</span>
<span class="n">rosenbrock_dvs</span> <span class="o">=</span> <span class="n">RosenbrockDVs</span><span class="p">(</span><span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;dvs&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># Construct the analysis object for the Rosenbrock function</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">100.0</span>

<span class="n">rosenbrock</span> <span class="o">=</span> <span class="n">Rosenbrock</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;rosenbrock&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span>
<span class="p">)</span>

<span class="c1"># Construct the analysis object for the constraint on the design variables</span>
<span class="n">rosenbrock_con</span> <span class="o">=</span> <span class="n">RosenbrockConstraint</span><span class="p">(</span>
    <span class="n">obj_name</span><span class="o">=</span><span class="s2">&quot;con&quot;</span><span class="p">,</span> <span class="n">sub_analyses</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock_dvs</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Construct the system</span>
<span class="n">flume_sys</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span>
    <span class="n">sys_name</span><span class="o">=</span><span class="s2">&quot;rosen_sys_con&quot;</span><span class="p">,</span>
    <span class="n">top_level_analysis_list</span><span class="o">=</span><span class="p">[</span><span class="n">rosenbrock</span><span class="p">,</span> <span class="n">rosenbrock_con</span><span class="p">],</span>
    <span class="n">log_name</span><span class="o">=</span><span class="s2">&quot;flume.log&quot;</span><span class="p">,</span>
    <span class="n">log_prefix</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Graph the system network to visualize connections</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">flume_sys</span><span class="o">.</span><span class="n">graph_network</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;ConstrainedRosenbrock&quot;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
<span class="p">)</span>

<span class="c1"># Declare the design variables for the system</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_design_vars</span><span class="p">(</span>
    <span class="n">global_var_name</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;dvs.x_dv&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lb&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
        <span class="s2">&quot;dvs.y_dv&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lb&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Declare the objective</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_objective</span><span class="p">(</span><span class="n">global_obj_name</span><span class="o">=</span><span class="s2">&quot;rosenbrock.f&quot;</span><span class="p">)</span>

<span class="c1"># Declare the constraint</span>
<span class="n">flume_sys</span><span class="o">.</span><span class="n">declare_constraints</span><span class="p">(</span>
    <span class="n">global_con_name</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;con.g&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;leq&quot;</span><span class="p">,</span> <span class="s2">&quot;rhs&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}}</span>
<span class="p">)</span>


<span class="c1"># Construct the Scipy interface</span>
<span class="n">interface</span> <span class="o">=</span> <span class="n">FlumeScipyInterface</span><span class="p">(</span><span class="n">flume_sys</span><span class="o">=</span><span class="n">flume_sys</span><span class="p">)</span>

<span class="c1"># Set a random starting point</span>
<span class="n">init_global_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dvs.x_dv&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="s2">&quot;dvs.y_dv&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">initial_point</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">set_initial_point</span><span class="p">(</span>
    <span class="n">initial_global_vars</span><span class="o">=</span><span class="n">init_global_vars</span>
<span class="p">)</span>

<span class="c1"># Optimize the problem with SciPy minimize</span>
<span class="n">x</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">optimize_system</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">initial_point</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;SLSQP&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: There was an error checking the latest version of pip.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.78641515 0.61769832]
 message: Optimization terminated successfully
 success: True
  status: 0
     fun: 0.04567480871896031
       x: [ 7.864e-01  6.177e-01]
     nit: 10
     jac: [-1.911e-01 -1.501e-01]
    nfev: 14
    njev: 10
</pre></div></div>
</div>
</section>
</section>
<section id="Other-Resources-to-Review">
<h2>Other Resources to Review<a class="headerlink" href="#Other-Resources-to-Review" title="Link to this heading"></a></h2>
<p>This concludes the overview of <em>Flume</em> and the descriptions provided in context of the constrained Rosenbrock example. For new users, exploring additional examples within the <a class="reference external" href="https://github.com/smdogroup/flume/tree/main/examples">examples gallery</a> will provide further insight into <em>Flume</em> in the context of different problems. A few other useful methods for <em>Analysis</em> classes are also discussed in the <a class="reference internal" href="analysis_methods_demo.html"><span class="doc">methods overview</span></a>, although these are intended to be
helper methods and do not constitute critical features for using the framework.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Flume" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="analysis_methods_demo.html" class="btn btn-neutral float-right" title="Useful Methods Demonstration for Analysis Instances" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cameron Smith.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>